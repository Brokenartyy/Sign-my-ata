<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Sign My ATA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!--
  so when you gonna tell him,
  that we did that too?
  he thinks it's exquisite,
  but it's all reused
  that was our fight, we talked about 
  i made the memes, you send to him when he's with you 

  do you get d√©j√† vu when he's with you?
  -->

  <link href="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.snow.css" rel="stylesheet"/>

  <style>
    body { font-family: system-ui, sans-serif; background: #fff5fa; padding: 20px; }
    h1 { text-align: center; margin-bottom: 20px; }

    /* ================= BASE PASTEL THEME ================= */
body {
  background-image: url("https://id.pinterest.com/pin/888053620449914737/sent/?invite_code=282c6fd52cc743b290e2d1787422833a&sfo=1");
  background-repeat: no-repeat;
  background-position: center 40px;
  background-size: 260px;
}


h1 {
  color: #c86491; /* pink pastel deeper */
  font-size: 2rem;
  margin-bottom: 1rem;
  text-align: center;
}

h5 {
  color: #c86491;
  text-align: center;
}

/* ================= EDITOR & FORM ================= */
#editor {
  background: #ffffff;
  border: 2px solid #ffd1dc; /* border pink pastel */
  border-radius: 12px;
  min-height: 120px;
  margin-bottom: 0.5rem;
}

#counter {
  text-align: right;
  color: #6b6b6b;
  margin-bottom: 0.8rem;
}

/* ================= BUTTON ================= */
button {
  background: #c8fbd8; /* ijo pastel */
  color: #333;
  padding: 0.8rem 1.4rem;
  font-size: 1rem;
  border-radius: 10px;
  border: none;
  font-weight: 600;
  transition: 0.2s ease;
}

button:hover {
  background: #b2efca; /* sedikit lebih gelap */
  transform: translateY(-2px);
}

/* ================= NAME & GITHUB FORM ================= */

.identity-box {
  background: #fffdf6;
  border: 2px solid #ffd1dc;
  border-radius: 20px;
  padding: 16px;
  margin-bottom: 16px;
  display: flex;
  flex-direction: column;
  gap: 12px;
}

/* label palsu biar keliatan niat */
.identity-box::before {
  content: "Identitas (opsional)";
  font-size: 11px;
  font-weight: 600;
  color: #c86491;
}

/* base input */
.identity-box input {
  width: 100%;
  padding: 14px 16px;
  border-radius: 16px;
  border: none;
  font-size: 14px;
  outline: none;
  background: #ffffff;
  transition: 0.2s ease;
}

/* NAME ‚Äì lebih dominan */
.identity-box #nameInput {
  font-weight: 600;
  box-shadow: inset 0 0 0 2px #ffd1dc;
}

/* GITHUB ‚Äì lebih soft & opsional */
.identity-box #githubInput {
  font-size: 13px;
  background: #f9fffb;
  box-shadow: inset 0 0 0 2px #c8fbd8;
}

/* focus effect */
.identity-box #nameInput:focus {
  box-shadow:
    inset 0 0 0 2px #c86491,
    0 0 0 4px rgba(200, 100, 145, 0.15);
}

.identity-box #githubInput:focus {
  box-shadow:
    inset 0 0 0 2px #4fa3a5,
    0 0 0 4px rgba(79, 163, 165, 0.18);
}

/* placeholder lembut */
.identity-box input::placeholder {
  color: #aaa;
}
    
/* ================= COMMENTS ================= */
.comment {
  background: #ffffff;
  border-left: 6px solid #ffd1dc; /* pink pastel accent */
  padding: 12px 16px;
  margin-top: 14px;
  border-radius: 10px;
  box-shadow: 0px 1px 4px rgba(0, 0, 0, 0.06);
}

.comment .anon {
  display: block;
  font-size: 12px;
  color: #4a4a4a;
  margin-bottom: 4px;


/* ================= LOADING / NOTICE ================= */
#loading {
  text-align: center;
  padding: 16px;
  font-size: 1.1rem;
  font-weight: bold;
  color: #c86491;
}

/* ================= RESPONSIVE ================= */
@media (max-width: 600px) {
  button {
    width: 100%;
  }
}

  @media (max-width: 600px) {
  .input-row {
    flex-direction: column;
  }
  }

/* ============= REPLY STYLING ========= */    
.reply {
  margin-top: 10px;
  padding: 10px 12px;
  border-left: 4px solid #c8fbd8;
  background: #f4fff8;
  border-radius: 8px;
  font-size: 14px;
}
.reply strong {
  color: #4fa3a5;
}

/* ============== IFRAME ============== */
 /* === RAIDEN HEADER === */
.raiden-wrap {
  max-width: 320px;        /* KUNCI ANTI GEDE */
  margin: 14px auto 20px;
  border-radius: 18px;
  overflow: hidden;
  transition: 0.25s ease;
}

/* Nurutin Tenor iframe */
.raiden-wrap iframe,
.raiden-wrap .tenor-gif-embed {
  width: 100% !important;
  height: auto !important;
}

/* Hover imut */
.raiden-wrap:hover {
  transform: scale(1.05) rotate(-1deg);
  box-shadow: 0 10px 24px rgba(0,0,0,0.18);
}

/* Mobile lebih sopan */
@media (max-width: 600px) {
  .raiden-wrap {
    max-width: 260px;
  }
}

.raiden-wrap:active {
  transform: scale(0.97);
}

/* ==== GIF NGARAH KE ADMIN ======= */
  #raiden-gif {
  cursor: pointer;
  max-width: 420px;
  margin: 20px auto;
  transition: transform 0.2s ease;
}

#raiden-gif:active {
  transform: scale(0.98);
}
  </style>
</head>
<body>

<h1>ü™ß Sign My ATA</h1>

<div id="raiden-gif">
  <div class="tenor-gif-embed"
    data-postid="16959263992561836066"
    data-share-method="host"
    data-aspect-ratio="1.76596"
    data-width="100%">
    <a href="https://tenor.com/view/raiden-fortnite-raiden-fortnite-emote-cat-emote-fortnite-raiden-mgs2-mgs2-raiden-gif-16959263992561836066">
      Raiden GIF
    </a>
  </div>
</div>

<script async src="https://tenor.com/embed.js"></script>

<h5>‚ö†Ô∏è Careful, he bites</h5>
  
  <div class="form-box">  
 <div class="form-wrapper">

  <div class="identity-box">
    <input id="nameInput" placeholder="Nama anon (bebas, boleh)" />
   
 <input id="githubInput" placeholder="GitHub (opsional, contoh: username)" />
  </div>

  <!-- quill toolbar -->
  <div id="toolbar"></div>

  <!-- editor -->
  <div id="editor"></div>

 </div> 

<div id="counter">0 karakter</div>
<button id="sendBtn" type="button" onclick="sendMessage()">Kirim</button>

<div id="comments"></div>

<script src="https://cdn.jsdelivr.net/npm/quill@1.3.7/dist/quill.min.js"></script>

<script type="module">
  // ================= FIREBASE IMPORT =================
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    onSnapshot,
    query,
    orderBy,
    serverTimestamp,
    limit
  } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  // ================= CONFIG =================
  const firebaseConfig = {
    apiKey: "AIzaSyCxzqdHlEFi5lIuen7vW9u2cxNbe3mPiio",
    authDomain: "pony-ata.firebaseapp.com",
    projectId: "pony-ata"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const commentsRef = collection(db, "messages");

  // ================= DOM =================
  const commentsDiv = document.getElementById("comments");
  const sendBtn = document.getElementById("sendBtn");
  const counter = document.getElementById("counter");

  // ================= QUILL (GLOBAL) =================
  window.quill = new Quill("#editor", {
    theme: "snow",
    placeholder: "Tulis pesan anonim...",
    modules: {
      toolbar: [
        ["bold", "italic", "underline"],
        [{ list: "bullet" }],
        ["clean"]
      ]
    }
  });

  // ================= COUNTER =================
  window.quill.on("text-change", () => {
    const length = window.quill.getText().trim().length;
    counter.textContent = `${length} karakter`;
  });

  const MAX_CHAR = 10000;

window.quill.on("text-change", () => {
  const length = window.quill.getLength();

  if (length > MAX_CHAR) {
    window.quill.deleteText(MAX_CHAR, length);
  }

  counter.textContent = `${length - 1} / ${MAX_CHAR}`;
});
  

  // ================= RANDOM ANON =================
  const nameInput = document.getElementById("nameInput");

function getAnonName() {
  const value = nameInput.value.trim();

  if (value.length === 0) {
    const fallback = [
      "Anon Pony",
      "Anon Fox",
      "Anon Ghost",
      "Anon Star",
      "Anon Cat"
    ];
    return fallback[Math.floor(Math.random() * fallback.length)];
  }

  return value;
}

  // ================= GITHUB LINK =================
  const githubInput = document.getElementById("githubInput");

function getGithubLink() {
  const value = githubInput.value.trim();

  if (!value) return null;

  // auto rapihin kalau user cuma nulis username
  if (!value.startsWith("http")) {
    return `https://github.com/${value}`;
  }

  return value;
}
  
  // ================= SEND MESSAGE =================
  window.sendMessage = async function () {
    window.quill.blur();

    const text = window.quill.getText().trim();
    if (!text) {
      alert("Pesan kosong üò≠");
      return;
    }

    if (text.length > MAX_CHAR) {
  alert("Kepanjangan üò≠ maksimal 10.000 karakter");
  return;
    }

    sendBtn.disabled = true;
    sendBtn.textContent = "Mengirim...";

    try {
    await addDoc(commentsRef, {
    name: getAnonName(),
    github: getGithubLink(), // üëà BARU
    content: window.quill.root.innerHTML,
    createdAt: serverTimestamp()
  });


      window.quill.setText("");
      githubInput.value = "";
      
    } catch (err) {
      alert("Gagal kirim pesan üò≠");
      console.error(err);
    }

    sendBtn.disabled = false;
    sendBtn.textContent = "Kirim";
  };

  // ================= REALTIME LISTENER =================
  const q = query(
    commentsRef,
    orderBy("createdAt", "desc"),
    limit(20) // biar gak berat
  );

  onSnapshot(q, (snapshot) => {
    // hapus loading halaman (kalau ada)
    document.getElementById("loading")?.remove();

    commentsDiv.innerHTML = "";

    snapshot.forEach((doc) => {
      const d = doc.data();
      const el = document.createElement("div");
      el.className = "comment";
      el.innerHTML = `
  <span class="anon">${d.name || "Anon"}</span>
  ${d.github ? `<a class="github" href="${d.github}" target="_blank">GitHub</a>` : ""}
  ${d.content}

  ${
    d.reply
      ? `<div class="reply">
           <strong>Nanaa</strong>
           ${d.reply.text}
         </div>`
      : ""
  }

  <small>${d.createdAt?.toDate()?.toLocaleString() || "baru saja"}</small>
`;


      commentsDiv.appendChild(el);
    });
  });
</script>

<script>
const raidenGif = document.getElementById("raiden-gif");

let clickTimer = null;

raidenGif.addEventListener("click", () => {
  if (clickTimer === null) {
    clickTimer = setTimeout(() => {
      clickTimer = null;
    }, 300);
  } else {
    clearTimeout(clickTimer);
    clickTimer = null;

    // DOUBLE CLICK DETECTED
    window.location.href = "admin.html";
  }
});
</script>
    
</body>
</html>
